apiVersion: networking.istio.io/v1alpha3
kind: VirtualService
metadata:
  name: helloapi
  namespace: test
spec:
  gateways:
    - test-gateway
  hosts:
    - "helloapp.phoenix.com"
  http:
    - match:
        - uri:
            prefix: /hello
          headers:
            end-user:
              exact: "phoenix-user"
      route:
        - destination:
            host: helloapi
            port:
              number: 5000
            subset: canary
    - match:
        - uri:
            prefix: /hello
      route:
        - destination:
            host: helloapi
            port:
              number: 5000
            subset: stable
